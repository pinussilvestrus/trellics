angular.module("trelloService",[]).factory("Trello",function($http,$q,$rootScope){var trello={},authenticationSuccess=function(){trello.getUserData(),trello.initializeBoards()},authenticationFailure=function(){console.log("failure")};return trello.init=function(){Trello.authorize({type:"popup",name:"Getting Started Application",scope:{read:!0,write:!0},expiration:"never",success:authenticationSuccess,error:authenticationFailure})},trello.getUserData=function(){var getSuccess=function(data){$rootScope.userData=data};Trello.get("/members/me",getSuccess)},trello.initializeBoards=function(){var getSuccess=function(data){$rootScope.$apply(function(){$rootScope.boards=[],$rootScope.loading=!1,$rootScope.boards=data})};Trello.get("/members/me/boards",getSuccess)},trello.getBoard=function(id){trello.init();var getSuccess=function(data){$rootScope.$apply(function(){$rootScope.data=data,$rootScope.loading=!1,$rootScope.initializeTimeline()})};Trello.get("/boards/"+id+"/lists?cards=open&card_fields=all&fields=name",getSuccess)},trello});
angular.module("mainApp",["ngRoute","ui.bootstrap","trelloService","mainController","cardDirective","angular-timeline"]).run(function($rootScope){$rootScope.data=[],$rootScope.boards=[],$rootScope.userData={};var _createTimeStamp=function(dateString){var date=new Date(dateString),options={weekday:"long",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return date.toLocaleDateString("de-de",options)};$rootScope.isConnected=function(){return localStorage.getItem("trello_token")},$rootScope.initializeTimeline=function(){$rootScope.events=[];for(var i=0;i<$rootScope.data.length;i++)for(var list=$rootScope.data[i],j=0;j<list.cards.length;j++){var card=list.cards[j],side="right";(j+i)%2==0&&(side="left"),$rootScope.events.push({badgeClass:"info",badgeIconClass:"glyphicon-check",title:card.name,date:card.dateLastActivity,content:_createTimeStamp(card.dateLastActivity)})}$rootScope.events.sort(function(e1,e2){return new Date(e1.date)-new Date(e2.date)})}}),$("#btnSave").click(function(){html2canvas($("#board"),{onrendered:function(canvas){theCanvas=canvas,document.body.appendChild(canvas),Canvas2Image.saveAsPNG(canvas),$("#img-out").append(canvas)}})});
angular.module("cardDirective",[]).directive("card",function(){"use strict";return{restrict:"E",templateUrl:"/app/js/directives/Card.html",scope:{model:"="},link:function(scope){}}}).directive("list",function(){"use strict";return{restrict:"E",templateUrl:"/app/js/directives/List.html",scope:{model:"="},link:function(scope){}}});
angular.module("mainController",["trelloService"]).controller("mainController",function($http,$scope,$window,$sce,$rootScope,$location,Trello){$rootScope.events=[],$scope.initialize=function(){$rootScope.loading=!0,Trello.init()},$scope.getBoard=function(id){Trello.getBoard(id)},$scope.logout=function(){localStorage.removeItem("trello_token"),$rootScope.data=[],$rootScope.boards=[],$rootScope.events=[],$rootScope.userData={}},$scope.initializeTimeline=function(){$rootScope.initializeTimeline()}});